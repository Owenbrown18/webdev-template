---
import BaseLayout from '../layouts/BaseLayout.astro';
import ServicesHeroSection from '../components/services/hero/ServicesHeroSection.astro';
import ServicesOverviewSection from '../components/services/overview/ServicesOverviewSection.astro';
import AboutProcessSection from '../components/about/process/AboutProcessSection.astro';
import ServicesCatalogSection from '../components/services/catalog/ServicesCatalogSection.astro';
import ServicesHighlightsSection from '../components/services/highlights/ServicesHighlightsSection.astro';
import ServicesTestimonialsSection from '../components/services/testimonials/ServicesTestimonialsSection.astro';
import ServicesFaqSection from '../components/services/faq/ServicesFaqSection.astro';
import ServicesCtaSection from '../components/services/cta/ServicesCtaSection.astro';
import { site, servicesPage, getServicesPageMetadata, getServicesHeroVariant } from '../config/content';
import {
  normalizeBackgroundTone,
  normalizeBackgroundColor,
  sectionBackgroundClass,
  sectionBackgroundToneAttr,
  createBackgroundStyle,
} from '../utils/background';

const metadata = getServicesPageMetadata();
const title = metadata.title ?? 'Services';
const description = metadata.description ?? `See how ${site.name} supports every phase of your project.`;
const heroVariant = getServicesHeroVariant();
const heroIsFullscreen = heroVariant === 'fullscreen' || heroVariant === 'serviceshero';
const servicesProcess = servicesPage.process ?? {};
const servicesProcessSteps = Array.isArray(servicesProcess.steps)
  ? servicesProcess.steps.filter(Boolean)
  : [];
const servicesProcessTone = normalizeBackgroundTone(servicesProcess.background?.tone ?? 'none');
const servicesProcessBackgroundClass = sectionBackgroundClass(servicesProcessTone);
const servicesProcessToneAttr = sectionBackgroundToneAttr(servicesProcessTone);
const servicesProcessColor = normalizeBackgroundColor(servicesProcess.background?.color);
const servicesProcessBackgroundStyle = createBackgroundStyle(servicesProcessColor, servicesProcessTone);
const servicesProcessAnimationEnabled =
  servicesProcess.animation ?? true;
---
<BaseLayout title={title} description={description} heroIsFullscreen={heroIsFullscreen}>
  <div class="space-y-16 sm:space-y-20">
    <ServicesHeroSection />
    <ServicesOverviewSection id="services-scroll-target" tabindex="-1" />
    {servicesProcessSteps.length > 0 ? (
      <AboutProcessSection
        id="services-process"
        eyebrow={servicesProcess.eyebrow ?? undefined}
        title={servicesProcess.title ?? 'How we work'}
        intro={servicesProcess.intro ?? undefined}
        steps={servicesProcessSteps}
        backgroundClass={servicesProcessBackgroundClass}
        backgroundTone={servicesProcessToneAttr}
        backgroundStyle={servicesProcessBackgroundStyle}
        animationEnabled={servicesProcessAnimationEnabled !== false}
      />
    ) : null}
    <ServicesCatalogSection id="services-catalog" />
    <ServicesHighlightsSection />
    <ServicesTestimonialsSection id="services-testimonials" />
    <ServicesFaqSection id="services-faq" />
    <ServicesCtaSection id="services-cta" />
  </div>
</BaseLayout>
