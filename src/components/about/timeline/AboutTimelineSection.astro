---
import {
  about,
  getAboutTimelineVariant,
  getAboutTimelineBackgroundTone,
} from '../../../config/content';
import { normalizeBackgroundTone, sectionBackgroundClass } from '../../../utils/background';
import AboutTimelineVertical from './AboutTimelineVertical.astro';
import AboutTimelineMilestone from './AboutTimelineMilestone.astro';
import AboutTimelineSteps from './AboutTimelineSteps.astro';

const variants: Record<string, any> = {
  vertical: AboutTimelineVertical,
  milestone: AboutTimelineMilestone,
  steps: AboutTimelineSteps,
};

const variantKey = getAboutTimelineVariant();
const Component = variantKey === 'none' ? null : variants[variantKey] ?? variants.vertical;

const props = Astro.props ?? {};

const base = about.timeline ?? {};
const title = props.title ?? base.title ?? 'Our story in milestones';
const intro = props.intro ?? base.intro ?? 'A look at the moments that shaped how we show up for neighbors every day.';
const eyebrow = props.eyebrow ?? base.eyebrow;
const rawMilestones = Array.isArray(props.milestones) ? props.milestones : base.milestones;
const milestones = Array.isArray(rawMilestones) ? rawMilestones.filter(Boolean) : [];
const fallbackTone = getAboutTimelineBackgroundTone();
const backgroundTone = normalizeBackgroundTone(props.backgroundTone ?? base.background?.tone ?? fallbackTone);
const backgroundClass = sectionBackgroundClass(backgroundTone);
---
{Component && milestones.length > 0 ? (
  <Component
    title={title}
    intro={intro}
    eyebrow={eyebrow ?? undefined}
    milestones={milestones}
    backgroundClass={backgroundClass}
  />
) : null}
