---
import type { SiteContent } from '../../../types/content';
import ContactForm from './ContactForm.astro';

interface Props {
  site: SiteContent;
  title?: string;
  intro?: string;
  phoneLabel?: string | null;
  emailLabel?: string | null;
}

const {
  site,
  title = "Let's work together",
  intro = "Reach us by phone or email, or send details through the form. We're quick to respond.",
  phoneLabel,
  emailLabel,
}: Props = Astro.props as Props;

const hours = Array.isArray(site.hours) ? site.hours : [];
const phoneDigits = site.phone ? site.phone.replace(/[^\d+]/g, '') : '';
const phoneHref = phoneDigits ? `tel:${phoneDigits}` : '';
const emailHref = site.email ? `mailto:${site.email}` : '';
const addressParts = [
  site.address?.line1,
  site.address?.line2,
  [site.address?.city, site.address?.state].filter(Boolean).join(', '),
  site.address?.postalCode,
]
  .filter((part) => Boolean(part && part.trim?.()))
  .map((part) => (typeof part === 'string' ? part.trim() : part));
const addressDisplay = addressParts.join('\n');
---
<section class="py-16 sm:py-20">
  <div class="grid gap-12 sm:grid-cols-[minmax(0,1fr)_minmax(0,1.1fr)]">
    <article class="rounded-3xl border border-slate-200 bg-white p-8 shadow-sm sm:p-12">
      <h1 class="text-3xl font-semibold tracking-tight text-slate-900 sm:text-4xl">{title}</h1>
      <p class="mt-4 text-base text-slate-600">{intro}</p>
      <dl class="mt-8 space-y-6 text-sm text-slate-700">
        {site.phone && (
          <div>
            <dt class="font-semibold text-slate-900">Phone</dt>
            <dd class="mt-1">
              <a href={phoneHref} class="text-[color:var(--color-primary)] hover:underline">
                {phoneLabel ?? site.phone}
              </a>
            </dd>
          </div>
        )}
        {site.email && (
          <div>
            <dt class="font-semibold text-slate-900">Email</dt>
            <dd class="mt-1">
              <a href={emailHref} class="text-[color:var(--color-primary)] hover:underline">
                {emailLabel ?? site.email}
              </a>
            </dd>
          </div>
        )}
        {addressDisplay && (
          <div>
            <dt class="font-semibold text-slate-900">Visit</dt>
            <dd class="mt-1 whitespace-pre-line">{addressDisplay}</dd>
          </div>
        )}
        {hours.length > 0 && (
          <div>
            <dt class="font-semibold text-slate-900">Hours</dt>
            <dd class="mt-2 space-y-2">
              {hours.map(({ label, open, close }) => (
                <div class="flex justify-between text-sm">
                  <span>{label}</span>
                  <span>{open}{close ? ` â€“ ${close}` : ''}</span>
                </div>
              ))}
            </dd>
          </div>
        )}
      </dl>
    </article>
    <ContactForm class="mt-0" />
  </div>
</section>
