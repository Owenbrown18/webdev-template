---
import {
  site,
  home,
  getVideoVariant,
  getVideoBackgroundTone,
  isVideoAnimationEnabled,
} from '../../../config/content';
import type { SiteContent } from '../../../types/content';
import {
  normalizeBackgroundTone,
  normalizeBackgroundColor,
  sectionBackgroundClass,
  sectionBackgroundToneAttr,
  createBackgroundStyle,
} from '../../../utils/background';
import VideoHalf from './VideoHalf.astro';
import VideoFull from './VideoFull.astro';

const variants: Record<string, any> = {
  half: VideoHalf,
  full: VideoFull,
};

const variantKey = getVideoVariant();
const Component = variantKey === 'none' ? null : variants[variantKey] ?? variants.half;
const {
  eyebrow = 'See us in action',
  title = `${site.name} in motion`,
  intro = '',
  ...video
} = home.video ?? {};
const props = (Astro.props ?? {}) as Record<string, any>;
const {
  backgroundTone: overrideTone,
  backgroundColor: overrideColor,
  backgroundClass: overrideClass,
  animation: animationOverride,
  ...restProps
} = props;
const fallbackTone = getVideoBackgroundTone();
const backgroundTone = normalizeBackgroundTone(overrideTone ?? (home.video?.background?.tone ?? fallbackTone));
const backgroundClass = overrideClass ?? sectionBackgroundClass(backgroundTone);
const backgroundToneAttr = sectionBackgroundToneAttr(backgroundTone);
const backgroundColor = normalizeBackgroundColor(overrideColor ?? home.video?.background?.color);
const backgroundStyle = createBackgroundStyle(backgroundColor);
const animationEnabled = animationOverride !== undefined ? animationOverride : isVideoAnimationEnabled();
---
{Component ? (
  <Component
    site={site as SiteContent}
    video={video}
    eyebrow={eyebrow ?? undefined}
    title={title ?? undefined}
    intro={intro ?? undefined}
    backgroundClass={backgroundClass}
    backgroundTone={backgroundToneAttr}
    backgroundStyle={backgroundStyle}
    animationEnabled={animationEnabled !== false}
    {...restProps}
  />
) : null}
