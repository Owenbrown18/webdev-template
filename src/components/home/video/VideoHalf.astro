---
import type { SiteContent } from '../../../types/content';

interface Props {
  site: SiteContent;
  video?: {
    videoUrl?: string | null;
    localVideo?: string | null;
    posterUrl?: string | null;
    caption?: string | null;
  };
}

const { site, video = {} }: Props = Astro.props as Props;
const videoUrl = video.videoUrl ?? '';
const localVideo = video.localVideo ?? '';
const caption = video.caption ?? 'See our team in action.';
const posterUrl = video.posterUrl ?? '';
const useLocalVideo = Boolean(localVideo);
const hasEmbed = Boolean(videoUrl);
const shouldRender = useLocalVideo || hasEmbed;
---
{shouldRender && (
  <section class="py-12 sm:py-16">
    <div class="mx-auto max-w-5xl px-6">
      <figure class="overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-sm">
        <div class="relative aspect-[18/7] w-full bg-slate-900">
          {useLocalVideo ? (
            <video
              src={localVideo}
              poster={posterUrl || undefined}
              autoplay
              muted
              loop
              playsinline
              class="absolute inset-0 h-full w-full object-cover"
            ></video>
          ) : (
            <iframe
              src={videoUrl}
              title={`Video from ${site.name}`}
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              loading="lazy"
              class="absolute inset-0 h-full w-full"
            ></iframe>
          )}
        </div>
        {caption && (
          <figcaption class="px-6 py-4 text-sm text-slate-600">
            {caption}
          </figcaption>
        )}
      </figure>
    </div>
  </section>
)}
