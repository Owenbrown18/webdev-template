---
import type { SiteContent } from '../../../types/content';

interface Props {
  site: SiteContent;
  video?: {
    videoUrl?: string | null;
    localVideo?: string | null;
    posterUrl?: string | null;
    caption?: string | null;
  };
  eyebrow?: string;
  title?: string;
  intro?: string;
  backgroundClass?: string;
}

const {
  site,
  video = {},
  eyebrow = 'See us in action',
  title = `${site.name} in motion`,
  intro = '',
  backgroundClass,
}: Props = Astro.props as Props;
const videoUrl = video.videoUrl ?? '';
const localVideo = video.localVideo ?? '';
const caption = video.caption ?? 'See our team in action.';
const posterUrl = video.posterUrl ?? '';
const useLocalVideo = Boolean(localVideo);
const hasEmbed = Boolean(videoUrl);
const shouldRender = useLocalVideo || hasEmbed;
const sectionClasses = [backgroundClass, 'section-shell'].filter(Boolean).join(' ');
---
{shouldRender && (
  <section class={sectionClasses}>
    <div class="section-container max-w-6xl">
      {(eyebrow || title || intro) && (
        <div class="section-intro max-w-3xl pb-10">
          {eyebrow && <p class="section-eyebrow">{eyebrow}</p>}
          {title && <h2 class="section-heading">{title}</h2>}
          {intro && <p class="section-subtitle">{intro}</p>}
        </div>
      )}
      <figure class="surface-card overflow-hidden">
        <div class="relative aspect-[16/7] w-full bg-slate-900">
          {useLocalVideo ? (
            <video
              src={localVideo}
              poster={posterUrl || undefined}
              autoplay
              muted
              loop
              playsinline
              class="absolute inset-0 h-full w-full object-cover"
            ></video>
          ) : (
            <iframe
              src={videoUrl}
              title={`Video from ${site.name}`}
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              loading="lazy"
              class="absolute inset-0 h-full w-full"
            ></iframe>
          )}
        </div>
        {caption && <figcaption class="px-8 py-6 text-sm text-slate-600">{caption}</figcaption>}
      </figure>
    </div>
  </section>
)}
