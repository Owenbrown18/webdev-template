---
import type { SiteContent } from '../../../types/content';

interface Props {
  site: SiteContent;
  hero?: {
    title?: string | null;
    subtitle?: string | null;
    primaryCtaLabel?: string | null;
    primaryCtaHref?: string | null;
    secondaryCtaLabel?: string | null;
    secondaryCtaHref?: string | null;
    image?: string | null;
  };
  backgroundClass?: string;
  animationEnabled?: boolean;
}

const { site, hero = {}, backgroundClass, animationEnabled = true }: Props = Astro.props as Props;

const title = hero.title ?? site.name;
const tagline = hero.subtitle ?? site.tagline;
const primaryLabel = hero.primaryCtaLabel ?? 'Contact Us';
const primaryHref = hero.primaryCtaHref ?? '/contact';
const showSecondary = Boolean(hero.secondaryCtaLabel && hero.secondaryCtaHref);
const secondaryLabel = hero.secondaryCtaLabel ?? 'Book now';
const secondaryHref = hero.secondaryCtaHref ?? '#booking';
const image = hero.image ?? '/images/hero.jpg';
const showBookingCta = Boolean(site.booking?.embedUrl) && !showSecondary;
const shouldAnimate = animationEnabled !== false;
const sectionClasses = [backgroundClass, 'section-shell'].filter(Boolean).join(' ');
const textClasses = [
  'flex flex-col justify-center gap-6',
  shouldAnimate
    ? 'motion-safe:opacity-0 motion-safe:translate-y-6 motion-safe:transition-all motion-safe:duration-[900ms] motion-safe:ease-out data-[visible=true]:motion-safe:opacity-100 data-[visible=true]:motion-safe:translate-y-0'
    : '',
]
  .filter(Boolean)
  .join(' ');
const imageWrapperClasses = [
  'relative h-full w-full overflow-hidden rounded-2xl bg-slate-900',
  shouldAnimate
    ? 'motion-safe:scale-[1.04] motion-safe:transition-transform motion-safe:duration-[1400ms] motion-safe:ease-out data-[visible=true]:motion-safe:scale-100'
    : '',
]
  .filter(Boolean)
  .join(' ');
---
<section
  class={sectionClasses}
  data-hero-root
  data-animate={shouldAnimate ? 'true' : undefined}
>
  <div class="section-container">
    <div class="surface-card grid gap-10 overflow-hidden p-6 sm:grid-cols-[minmax(0,1fr)_minmax(0,0.9fr)] sm:p-12">
      <div class={textClasses} data-hero-text>
        <p class="text-sm font-semibold uppercase tracking-[0.28em] text-brand-primary/90">
          Trusted Local Experts
        </p>
        <h1 class="text-4xl font-semibold tracking-tight text-slate-900 sm:text-5xl">{title}</h1>
        <p class="text-base leading-relaxed text-slate-600">{tagline}</p>
        <div class="flex flex-wrap gap-3">
          <a
            href={primaryHref}
            class="inline-flex items-center justify-center rounded-full bg-brand-primary px-6 py-3 text-base font-semibold text-white shadow-brand-glow transition hover:brightness-110"
          >
            {primaryLabel}
          </a>
          {showSecondary ? (
            <a
              href={secondaryHref}
              class="inline-flex items-center justify-center rounded-full border border-slate-200 px-6 py-3 text-base font-semibold text-slate-900 transition hover:border-brand-primary hover:text-brand-primary"
            >
              {secondaryLabel}
            </a>
          ) : (
            showBookingCta && (
              <a
                href="#booking"
                class="inline-flex items-center justify-center rounded-full border border-slate-200 px-6 py-3 text-base font-semibold text-slate-900 transition hover:border-brand-primary hover:text-brand-primary"
              >
                Book with {site.booking?.provider ?? 'us'}
              </a>
            )
          )}
        </div>
      </div>
      <div class={imageWrapperClasses} data-hero-image>
        <img
          src={image}
          alt=""
          class="h-full w-full object-cover"
          loading="lazy"
          decoding="async"
        />
        <div class="absolute inset-0 bg-slate-900/40" aria-hidden="true"></div>
        <div class="absolute bottom-6 left-6 right-6 rounded-2xl border border-white/15 bg-white/10 p-6 text-slate-50 shadow-card backdrop-blur">
          <p class="text-sm font-semibold text-white">Visit our showroom</p>
          <p class="mt-1 text-sm text-white/80">
            {site.address?.line1}
            {site.address?.line2 && `, ${site.address.line2}`}
          </p>
          <p class="text-sm text-white/80">
            {[site.address?.city, site.address?.state, site.address?.postalCode].filter(Boolean).join(', ')}
          </p>
        </div>
      </div>
    </div>
  </div>
  {shouldAnimate ? (
    <script>
      const roots = Array.from(document.querySelectorAll('[data-hero-root][data-animate="true"]'));
      const supportMatchMedia = typeof window !== 'undefined' && typeof window.matchMedia === 'function';
      const prefersReducedMotion = supportMatchMedia
        ? window.matchMedia('(prefers-reduced-motion: reduce)').matches
        : false;
      const reveal = (el: Element | null) => {
        if (el instanceof HTMLElement) {
          el.dataset.visible = 'true';
        }
      };

      roots.forEach((root) => {
        if (!(root instanceof HTMLElement)) {
          return;
        }

        if (root.dataset.heroAnimated === 'true') {
          return;
        }

        root.dataset.heroAnimated = 'true';
        const text = root.querySelector('[data-hero-text]');
        const image = root.querySelector('[data-hero-image]');

        if (prefersReducedMotion) {
          reveal(text);
          reveal(image);
          return;
        }

        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            reveal(text);
            reveal(image);
          });
        });
      });
    </script>
  ) : null}
</section>
