---
import {
  site,
  home,
  getHeroVariant,
  getHeroBackgroundTone,
  isHeroAnimationEnabled,
} from '../../../config/content';
import {
  normalizeBackgroundTone,
  normalizeBackgroundColor,
  sectionBackgroundClass,
  sectionBackgroundToneAttr,
  createBackgroundStyle,
} from '../../../utils/background';
import type { SiteContent } from '../../../types/content';
import HeroClassic from './HeroClassic.astro';
import HeroSplit from './HeroSplit.astro';
import HeroFullscreen from './HeroFullscreen.astro';

const variants: Record<string, any> = {
  classic: HeroClassic,
  split: HeroSplit,
  fullscreen: HeroFullscreen,
};

const variantKey = getHeroVariant();
const HeroComponent = variantKey === 'none' ? null : variants[variantKey] ?? variants.classic;
const hero = home.hero ?? {};
const props = (Astro.props ?? {}) as Record<string, any>;
const {
  backgroundTone: overrideTone,
  backgroundColor: overrideColor,
  backgroundClass: overrideClass,
  animation: animationOverride,
  ...restProps
} = props;
const fallbackTone = getHeroBackgroundTone();
const normalizedTone = normalizeBackgroundTone(overrideTone ?? hero.background?.tone ?? fallbackTone);
const effectiveTone = normalizedTone === 'aurora' && variantKey !== 'fullscreen' ? 'gradient' : normalizedTone;
const backgroundClass = overrideClass ?? sectionBackgroundClass(effectiveTone);
const backgroundToneAttr = sectionBackgroundToneAttr(effectiveTone);
const backgroundColor = normalizeBackgroundColor(overrideColor ?? hero.background?.color);
const backgroundStyle = createBackgroundStyle(backgroundColor, effectiveTone);
const animationSetting = animationOverride ?? hero.animation;
const animationEnabled = animationSetting ?? isHeroAnimationEnabled();
---
{HeroComponent ? (
  <HeroComponent
    site={site as SiteContent}
    hero={hero}
    backgroundClass={backgroundClass}
    backgroundTone={backgroundToneAttr}
    backgroundStyle={backgroundStyle}
    animationEnabled={animationEnabled !== false}
    {...restProps}
  />
) : null}
