---
import { home } from '../../../config/content';
import {
  normalizeBackgroundTone,
  normalizeBackgroundColor,
  sectionBackgroundClass,
  sectionBackgroundToneAttr,
  createBackgroundStyle,
} from '../../../utils/background';
import StatementCentered from '../statement/StatementCentered.astro';
import StatementSplit from '../statement/StatementSplit.astro';

const settings = home.aboutSection ?? {};
const props = (Astro.props ?? {}) as Record<string, any>;
const variantValue = props.variant ?? settings.variant;
const variantKey = typeof variantValue === 'string' ? variantValue.trim().toLowerCase() : undefined;

const {
  backgroundTone: overrideTone,
  backgroundColor: overrideColor,
  backgroundClass: overrideClass,
  animation: animationOverride,
  eyebrow: eyebrowOverride,
  title: titleOverride,
  intro: introOverride,
  image: imageOverride,
  ...restProps
} = props;

if ('variant' in restProps) {
  delete restProps.variant;
}

const variant = variantKey && variantKey !== '' ? variantKey : 'split';
const Component =
  variant === 'none'
    ? null
    : variant === 'centered'
    ? StatementCentered
    : StatementSplit;

const eyebrow = (eyebrowOverride ?? settings.eyebrow ?? undefined) as string | undefined;
const title = (titleOverride ?? settings.title ?? undefined) as string | undefined;
const intro = (introOverride ?? settings.intro ?? undefined) as string | undefined;
const image =
  (imageOverride ?? settings.image ?? undefined) as { src?: string | null; alt?: string | null } | undefined;

const backgroundTone = normalizeBackgroundTone(
  overrideTone ?? settings.background?.tone ?? 'none',
);
const backgroundClass = overrideClass ?? sectionBackgroundClass(backgroundTone);
const backgroundToneAttr = sectionBackgroundToneAttr(backgroundTone);
const backgroundColor = normalizeBackgroundColor(overrideColor ?? settings.background?.color);
const backgroundStyle = createBackgroundStyle(backgroundColor, backgroundTone);
const animationSetting =
  animationOverride !== undefined ? animationOverride : settings.animation;
const animationEnabled = animationSetting !== false;
---
{Component ? (
  <Component
    eyebrow={eyebrow}
    title={title}
    intro={intro}
    image={image}
    backgroundClass={backgroundClass}
    backgroundTone={backgroundToneAttr}
    backgroundStyle={backgroundStyle}
    animationEnabled={animationEnabled}
    {...restProps}
  />
) : null}
