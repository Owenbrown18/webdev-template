---
import ShowcaseHero from '../../shared/hero/ShowcaseHero.astro';
import {
  servicesPage,
  getServicesPageMetadata,
  getServicesHeroBackgroundTone,
  isServicesHeroAnimationEnabled,
} from '../../../config/content';
import {
  normalizeBackgroundTone,
  normalizeBackgroundColor,
  sectionBackgroundClass,
  sectionBackgroundToneAttr,
  createBackgroundStyle,
} from '../../../utils/background';

const hero = servicesPage.hero ?? {};
const metadata = getServicesPageMetadata();
const rawProps = (Astro.props ?? {}) as Record<string, any>;
const {
  backgroundTone: overrideTone,
  backgroundColor: overrideColor,
  backgroundClass: overrideClass,
  animation: animationOverride,
  ...restProps
} = rawProps;
delete restProps.backgroundTone;
delete restProps.backgroundColor;
delete restProps.backgroundClass;
delete restProps.animation;

const fallbackTone = getServicesHeroBackgroundTone();
const backgroundTone = normalizeBackgroundTone(overrideTone ?? hero.background?.tone ?? fallbackTone);
const backgroundClass = overrideClass ?? sectionBackgroundClass(backgroundTone);
const backgroundToneAttr = sectionBackgroundToneAttr(backgroundTone);
const backgroundColor = normalizeBackgroundColor(overrideColor ?? hero.background?.color);
const backgroundStyle = createBackgroundStyle(backgroundColor);
const animationSetting = animationOverride ?? hero.animation;
const animationEnabled = animationSetting ?? isServicesHeroAnimationEnabled();

const primaryCta =
  hero.primaryCtaLabel && hero.primaryCtaHref
    ? { label: hero.primaryCtaLabel, href: hero.primaryCtaHref }
    : null;
const secondaryCta =
  hero.secondaryCtaLabel && hero.secondaryCtaHref
    ? { label: hero.secondaryCtaLabel, href: hero.secondaryCtaHref }
    : null;

const heroDetails = Array.isArray(hero.details) ? hero.details : [];
const heroAlt = metadata.heroImageAlt ?? '';
---
<ShowcaseHero
  tagLabel={hero.tagLabel ?? 'Services'}
  title={hero.title ?? 'Reliable, end-to-end care for every project'}
  subtitle={
    hero.subtitle ??
      'Whether you need a one-off consult or an ongoing partner, our team brings seasoned expertise to every engagement.'
  }
  primaryCta={primaryCta}
  secondaryCta={secondaryCta}
  image={hero.image ?? '/images/about-hero.jpg'}
  heroImageAlt={heroAlt}
  details={heroDetails}
  backgroundClass={backgroundClass}
  backgroundTone={backgroundToneAttr}
  backgroundStyle={backgroundStyle}
  animationEnabled={animationEnabled}
  {...restProps}
/>
